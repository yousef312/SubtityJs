var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(p){return p.raw=p};$jscomp.createTemplateTagFirstArgWithRaw=function(p,u){p.raw=u;return p};
(function(p,u){"uses strict";"function"===typeof define&&define.amd?define([],build):"object"===typeof module&&module.exports?module.exports=u():p.Subtity=u()})(this,function(){function p(){this.subs=[];this.text=this.title="";this.subtitles=[];this.ranges=[];this.current=0;this.subtitlesCounts=null;this.offset=0;this.style={family:"Arial",size:19,style:"normal",lineSpacing:5,variant:"normal",color:"rgb(255,255,255)",align:"center",direction:"ltr",outlineColor:"rgb(0,0,0)",outlineSize:1,shadowColor:"rgba(0,0,0,0)",
opacity:1,shadowBlur:0,shadowX:0,shadowY:0,base:90,left:50,weight:""};this.container=this.renderer=null;this.meta={};this.video=this.mode=null;this.ctx=document.createElement("canvas").getContext("2d");this.activated=!1;this.currentFileType=null;this.speedFactor=1}var u="0123456789".split("");p.prototype={reset:function(){this.current=0;this.speedFactor=1;this.offset=0;this.style={family:"Arial",size:19,style:"normal",variant:"normal",lineSpacing:10,color:"rgb(255,255,255)",align:"center",direction:"ltr",
outlineColor:"rgb(0,0,0)",outlineSize:1,shadowColor:"rgba(0,0,0,0)",shadowBlur:0,opacity:1,shadowX:0,shadowY:0,base:90,left:50,weight:""};this.subtitles=[];this.ranges=[];this.activated=!1;this.subtitlesCounts=0;this.meta={};this.title="";this.currentFileType=null},use:function(a){var b=this,c=this.subs.findIndex(function(e){return e.title===a});if(-1!==c){if(""!==this.title){var d=this.subs.findIndex(function(e){return e.title===b.title});this.subs[d].used=!1}this.current=0;this.reset();this.subs[c].used=
!0;this.title=this.subs[c].title;this.ranges=this.subs[c].ranges;this.subtitles=this.subs[c].subtitles;this.text=this.subs[c].text;this.subtitlesCounts=this.subs[c].count;this.activated=!0;this.meta=this.subs[c].meta;this.currentFileType=this.subs[c].type;this.calcFontHeight()}},parseSRT:function(a,b,c){var d=a.split("\n");a={movie:c,title:b,ranges:[],meta:{},subtitles:[],text:a,count:0,type:"srt"};b=!1;c=[];for(var e=0;e<d.length;e++){var f=d[e];1!=f.length&&0!==f.length||0===c.length||(b=!1,a.subtitles.push(c),
c=[]);-1!==f.indexOf("--\x3e")?(a.ranges.push(this.getSeconds(f)),b=!0):!0===b&&1!==f.length&&c.push(f)}a.count=a.subtitles.length;this.subs.push(a)},parseXMLBased:function(a,b,c){var d=this,e=a.split("<body>")[1].split("</body>")[0].split("</div>"),f={movie:c,title:b,meta:{langs:{}},ranges:[],subtitles:[],text:a,type:"dfxp"},g=null,h=null,l=null,q=null;for(a=0;a<e.length;a++)if(b=e[a].split("<div ")[1],void 0!==b){var r=b.substr(0,b.indexOf(">")).split(" ");r.forEach(function(v,m){r[m]=r[m].split("=");
"xml:lang"===r[m][0]&&(g=r[m][1].replaceAll('"',""),null===l&&(l=g),f.meta.langs[g]=[])});b=b.split("</p>");null===g&&(g="en",null===l&&(l=g));for(c=0;c<b.length;c++){var n=b[c].split("<p ")[1];void 0!==n&&(n=n.substr(n.indexOf(">")+1,n.length),0===a&&(h=n.substr(0,n.indexOf(">")).split(" "),q=[],h.forEach(function(v,m){h[m]=h[m].split("=");"begin"===h[m][0]?q[0]=d.convertToTime(h[m][1].replaceAll('"',"")):"end"===h[m][0]&&(q[1]=d.convertToTime(h[m][1].replaceAll('"',"")))})),f.ranges.push(q),f.meta.langs[g].push(n.split("<br />")))}}f.subtitles=
f.meta.langs[l];f.count=f.subtitles.length;this.subs.push(f)},parseXML:function(a,b,c){var d=a.split("<video>")[1].split("<video/>")[0].split("</title>");a={movie:c,title:b,meta:{},ranges:[],subtitles:[],text:a,type:"xml"};d.pop();for(b=0;b<d.length;b++)c=d[b].split("<title>")[1],rang0=this.convertToTime(c.split("<start>")[1].split("</start>")[0].replace(";",".")),rang1=this.convertToTime(c.split("<end>")[1].split("</end>")[0].replace(";",".")),rang=[rang0,rang1],a.ranges.push(rang),subtitle=c.split("<text>")[1].split("</text>")[0].split("<br/>"),
a.subtitles.push(subtitle);a.count=a.subtitles.length;this.subs.push(a)},parseWEBVTT:function(a,b,c){var d=a.split("\n"),e=!1;a={movie:c,title:b,meta:{},ranges:[],subtitles:[],text:a,type:"webvtt"};b=[];for(c=0;c<d.length;c++){var f=d[c];-1===f.indexOf("NOTE ")&&-1===f[0].indexOf("NOTE\n")&&(!e||1===f.length&&0===f.length||b.push(f),-1!==f.indexOf("--\x3e")?(e=this.getSeconds(f),a.ranges.push(e),e=!0):1!==f.length&&0!==f.length||!0!==e||(e=!1,a.subtitles.push(b),b=[]))}a.count=a.subtitles.length;
this.subs.push(a)},parseSBV:function(a,b,c){var d=a.split("\n"),e=!1,f=!1,g=-1;a={movie:c,title:b,meta:{},ranges:[],subtitles:[],text:a,type:"sbv"};if(1===d[0].length||0===d[0].length)e=!0;for(b=0;b<d.length;b++)if(c=d[b],!0===f&&1!==c.length&&0!==c.length&&a.subtitles[g].push(c),!0===e&&(a.ranges.push(this.getSeconds(c)),e=!1,f=!0,g++,a.subtitles[g]=[]),1===c.length||0===c.length)e=!0,f=!1;a.count=a.subtitles.length;this.subs.push(a)},parseSSA:function(a,b,c){var d=a.split("\n"),e=null,f=null;a=
{movie:c,title:b,meta:{},ranges:[],subtitles:[],count:null,text:a,type:"ssa"};for(b=0;b<d.length;b++)if(c=d[b],"["===c[0])f=c.substr(1,c.indexOf("]")-1).toLowerCase();else if("events"===f){c=c.split(":");if(2<c.length){for(var g=2;g<c.length;g++)c[1]+=":"+c[g];c.splice(2,c.length)}g=c[0].toLowerCase();c=c[1];"format"===g?e=c.toLowerCase().split(","):"dialogue"===g&&(c=c.split(","),k=e.findIndex(function(h){return"text"===h.trim()}),g=c[k],i0=e.findIndex(function(h){return"start"===h.toLowerCase().trim()}),
i1=e.findIndex(function(h){return"end"===h.toLowerCase().trim()}),t1=this.convertToTime(c[i0]),t2=this.convertToTime(c[i1]),a.ranges.push([t1,t2]),a.subtitles.push([g]))}else"script info"===f&&";"!==c[0]&&(c=c.split(":"),g=c[0],a.meta[g]=c[1]);a.count=a.subtitles.length;this.subs.push(a)},parseRT:function(a,b,c){var d=a.split("<br/>");b={movie:c,title:b,meta:{},ranges:[],subtitles:[],count:null,text:a,type:"rt"};d.shift();d[d.length-1]=d[d.length-1].split("</font>")[0];for(c=0;c<d.length;c++){a=d[c].split("<clear/>");
rang=a[0].split("<time ")[1].split("/>")[0].split(" ");rangout=[];for(var e=0;e<rang.length;e++){var f=rang[e].split("=");prop=f[0].toLowerCase();config=f[1].replaceAll('"',"");"begin"===prop?rangout[0]=parseFloat(config):"end"===prop&&(rangout[1]=parseFloat(config))}void 0!==b.ranges[b.ranges.length-1]&&1===b.ranges[b.ranges.length-1].length&&b.ranges[b.ranges.length-1].push(rangout[0]);b.ranges.push(rangout);b.subtitles.push(a[1].split("<br>"))}b.count=b.subtitles.length;this.subs.push(b)},parseITT:function(a,
b,c){var d=a.split("<body>")[1].split("</body>")[0].split("<p ");a={movie:c,title:b,meta:{},ranges:[],subtitles:[],count:null,text:a,type:"itt"};for(b=0;b<d.length;b++)if("b"===d[b][0]){c=d[b].split(">");var e=c[0].split('"');e=[this.convertToTime(e[1]),this.convertToTime(e[3])];e[1]+=e[0];c.shift();for(var f="",g=0;g<c.length;g++){var h=c[g].replaceAll("<br","\n");for(var l=0;l<h.length&&"<span"!==h[l]+h[l+1]+h[l+2]+h[l+3]+h[l+4]&&"</"!==h[l]+h[l+1];l++)f+=h[l]}f=f.split("\n");a.ranges.push(e);a.subtitles.push(f)}a.count=
a.subtitles.length;this.subs.push(a)},parseUSF:function(a,b,c){var d=a.split("<metadata>")[1].split("</metadata>")[0],e=a.split("<subtitles>")[1].split("</subtitles>")[0].split("<subtitle ");a={movie:c,title:b,ranges:[],meta:{},subtitles:[],count:null,text:a,type:"usf"};var f=c="",g=!1;b=[null,null];-1!==d.indexOf("<title>")&&(a.meta.title=d.split("<title>")[1].split("</title>")[0]);-1!==d.indexOf("<date>")&&(a.meta.date=d.split("<date>")[1].split("</date>")[0]);-1!==d.indexOf("<author>")&&(c=d.split("<author>")[1].split("</author>")[0],
-1!==c.indexOf("<name>")&&(a.meta.authorName=c.split("<name>")[1].split("</name>")[0]),-1!==c.indexOf("<url>")&&(a.meta.authorUrl=c.split("<url>")[1].split("</url>")[0]),-1!==c.indexOf("<email>")&&(a.meta.authorEmail=c.split("<email>")[1].split("</email>")[0]));-1!==d.indexOf("<language")&&(a.meta.language="",t=d.split("<language ")[1].split("</language>")[0],a.meta.language=t.substr(t.indexOf(">")+1,t.length));for(d=0;d<e.length;d++)if("s"===e[d][0]){c=e[d];var h=e[d].split(">")[0].split('"'),l=
this.convertToTime(h[1]);h=this.convertToTime(h[3]);-1!==c.indexOf("<text ")?(b[0]="<text ",b[1]="</text>"):-1!==c.indexOf("<karaoke ")&&(b[0]="<karaoke ",b[1]="</karaoke>");f=c.split(b[0])[1].split(b[1])[0];c="";g=!1;for(var q=f.indexOf(">");q<f.length;q++){var r=f[q];"<"===f[q]&&" "!==f[q+1]&&(g=!1);g&&(c+=r);">"===r&&(g=!0)}f=a.ranges.findIndex(function(n){return l>=n[0]&&l<=n[1]});-1!==f?a.subtitles[f]=a.subtitles[f].concat(c.split("\n")):(a.subtitles.push(c.split("\n")),a.ranges.push([l,h]))}a.count=
a.subtitles.length;this.subs.push(a)},parseSUBTI:function(a,b,c){var d=a.split("==");a={movie:c,title:b,meta:{},ranges:[],subtitles:[],count:null,text:a,type:"subti"};b=d[0].split("\n");b.pop();for(c=0;c<b.length;c++){var e=b[c].split("=");a.meta[e[0]]=e[1]}a.meta.names=[];for(b=1;b<d.length;b++)c=d[b].split("\n"),a.meta.names.push(c[0]),c.shift(),a.ranges.push(this.getSeconds(c[0])),c.shift(),""===c[c.length-1]&&c.pop(),a.subtitles.push(c);a.count=a.subtitles.length;this.subs.push(a)},parseLRC:function(a,
b,c){var d=a.split("\n");a={movie:c,title:b,meta:{},ranges:[],subtitles:[],count:null,text:a,type:"lrc"};for(b=0;b<d.length;b++)if(1!==d[b].length&&0!==d[b].length){var e=d[b].split("[")[1].split("]");c=e[0];e=e[1];-1===u.indexOf(c[0])?(subj=c.substr(0,c.indexOf(":")),elm=c.substr(c.indexOf(":")+1,c.length),"au"===subj&&(subj="author"),"ar"===subj&&(subj="artist"),"al"===subj&&(subj="album"),"ti"===subj&&(subj="title"),a.meta[subj]=elm):(rang=this.convertToTime(c),k=a.ranges.push([rang]),a.subtitles.push([e]),
void 0!==a.ranges[k-2]&&a.ranges[k-2].push(rang))}a.ranges[a.ranges.length-1].push(Infinity);a.count=a.subtitles.length;this.subs.push(a)},convertToText:function(a,b,c){b=void 0===b?":":b;c=void 0===c?".":c;var d=Math.floor(a/3600);a-=3600*d;var e=Math.floor(a/60);a=(a-60*e).toFixed(2);a=a.replace(".",c);return d+b+e+b+a},convertToTime:function(a){var b=a.split(":");if(3===b.length){b[2]=b[2].replace(",",".");a=parseFloat(b[0]);var c=parseFloat(b[1]);b=parseFloat(b[2])}else b[1]=b[1].replace(",",
"."),a=0,c=parseFloat(b[0]),b=parseFloat(b[1]);return 0+(3600*a+60*c+b)},getSeconds:function(a){var b=[0,0];a=-1!==a.indexOf("=>")?a.split("=>"):-1===a.indexOf("--\x3e")?a.split(","):a.split("--\x3e");b[0]=this.convertToTime(a[0]);b[1]=this.convertToTime(a[1]);return b},update:function(){if(null===this.mode)console.warn("Must set up the parser rendering mode first!`Subtity.setUp2D or Subtity.setUpContainer`");else if(0!==this.ranges.length&&0!==this.subtitles.length&&!1!==this.activated){current=
this.video.currentTime*this.speedFactor;mov=this.video.src;for(var a=0;a<this.ranges.length;a++){var b=this.ranges[a],c=this.subtitles[a];current-=this.offset;if(current>=b[0]&&current<=b[1])if(this.current=a,1===this.mode)this.container.innerText=this.subtitles[this.current];else{family=this.style.family||"Arial";style=this.style.style||"normal";variant=this.style.variant||"normal";base=this.style.base||90;left=this.style.left||50;size=this.style.size||25;align=this.style.align||"center";color=this.style.color||
"white";bg=this.style.bg||"rgba(0,0,0,0)";direction=this.style.direction||"ltr";opacity=this.style.opacity||1;weight=this.style.weight||"bold";marginL=this.style.marginLeft;marginT=this.style.marginTop;outlineColor=this.style.outlineColor||"black";outlineSize=this.style.outlineSize||1;shadowColor=this.style.shadowColor||"rgba(0,0,0,0)";shadowX=this.style.shadowX||0;shadowY=this.style.shadowY||0;shadowBlur=this.style.shadowBlur||0;lineSpacing=this.style.lineSpacing||0;lineHeight=this.style.lineHeight;
this.renderer.beginPath();x=this.renderer.canvas.width/100*left;y=this.renderer.canvas.height/100*base;this.renderer.fillStyle=color;this.renderer.textAlign=align;this.renderer.direction=direction;this.renderer.font=style+" "+variant+" "+weight+" "+size+"px "+family;this.renderer.shadowColor=shadowColor;this.renderer.shadowBlur=shadowBlur;this.renderer.shadowOffsetX=shadowX;this.renderer.shadowOffsetY=shadowY;this.renderer.globalAlpha=opacity;for(b=c.length-1;-1<b;b--){var d=c[b];this.renderer.strokeStyle=
outlineColor;this.renderer.lineWidth=2*outlineSize;this.renderer.strokeText(d,x,y);this.renderer.lineWidth=1;this.renderer.fillText(d,x,y);y-=lineHeight+lineSpacing}this.renderer.closePath()}}}},setUp2D:function(a,b){this.renderer=a instanceof CanvasRenderingContext2D?a:a.getContext("2d");this.mode=2;this.video=b},setUpContainer:function(a,b){this.container=a;this.mode=1;this.video=b},setOffset:function(a){this.offset="number"!==typeof a||isNaN(a)?this.offset:a},setSpeed:function(a){this.speedFactor=
"number"!==typeof a||isNaN(a)?this.speedFactor:a},set:function(a,b){switch(a){case "family":this.style.family=b;this.calcFontHeight();break;case "color":this.style.color=b;break;case "weight":this.style.weight=b;break;case "style":this.style.style=b;break;case "variant":this.style.variant=b;break;case "size":this.style.size=parseFloat(b);this.calcFontHeight();break;case "align":this.style.align=b;break;case "direction":this.style.direction=b;break;case "shawX":this.style.shadowX=parseFloat(b);break;
case "shawY":this.style.shadowY=parseFloat(b);break;case "shawBlur":this.style.shadowBlur=b;break;case "shawColor":this.style.shadowColor=b;break;case "bg":this.style.bg=b;break;case "outlineColor":this.style.outlineColor=b;break;case "outlineSize":this.style.outlineSize=parseFloat(b);break;case "lineSpacing":this.style.lineSpacing=parseFloat(b);break;case "base":this.style.base=parseFloat(b);break;case "left":this.style.left=parseFloat(b);break;case "opacity":this.style.opacity=isNaN(parseFloat(b))?
1:parseFloat(b)}},calcFontHeight:function(){fontSize=parseFloat(this.style.size);fontFamily=this.style.family;var a=this.ctx;a.canvas.width=a.canvas.width;a.fillRect(0,0,a.canvas.width,a.canvas.height);a.textBaseline="top";a.font=fontSize+"px "+fontFamily;a.fillStyle="white";a.fillText("gM",0,0);for(var b=a.getImageData(0,0,a.canvas.width,a.canvas.height).data,c=-1,d=-1,e=0;e<a.canvas.height;e++)for(var f=0;f<a.canvas.width;f++)if(0===b[4*(e*a.canvas.width+f)]){if(f===a.canvas.width-1&&-1!==c){d=
e;e=a.canvas.height;break}}else{-1===c&&(c=e);break}this.style.lineHeight=d-c},loadDefaultStyle:function(){this.style={family:"Arial",size:19,lineSpacing:10,color:"rgb(255,255,255)",align:"center",direction:"ltr",outlineColor:"rgb(0,0,0)",outlineSize:1,shadowColor:"rgba(0,0,0,0)",opacity:1,shadowBlur:0,shadowX:0,shadowY:0,base:90,left:50,weight:"",style:"normal",variant:"normal"}},toggleActivation:function(a){return this.activated="boolean"===typeof a?a:!this.activated},remove:function(a){var b=this.subs.findIndex(function(c){return c.title===
a});return-1!==b?(!0===this.subs[b].used&&this.reset(),this.subs.splice(b,1)):!1},add:function(a,b,c,d){"string"===typeof c&&"string"===typeof b&&""!==a&&!1!==this.check(a)&&(c=c.toLowerCase(),".srt"===c||"srt"===c?this.parseSRT(b,a,d):".sbv"===c||"sbv"===c?this.parseSBV(b,a,d):".itt"===c||"itt"===c?this.parseITT(b,a,d):".webvtt"===c||"webvtt"===c?this.parseWEBVTT(b,a,d):".ssa"===c||"ssa"===c?this.parseSSA(b,a,d):".usf"===c||"usf"===c?this.parseUSF(b,a,d):".lrc"===c||"lrc"===c?this.parseLRC(b,a,d):
".subti"===c||"subti"===c?this.parseSUBTI(b,a,d):".rt"===c||"rt"===c?this.parseRT(b,a,d):".dfxp"===c||"dfxp"===c||"ttml"===c||".ttml"===c?this.parseXMLBased(b,a,d):(".xml"===c||"xml"===c)&&this.parseXML(b,a,d))},"export":function(a){if("string"===typeof a){a=a.toLowerCase();var b=!1;if(".srt"===a||"srt"===a)b=this.exportToSRT();else if(".sbv"!==a&&"sbv"!==a&&".itt"!==a&&"itt"!==a)if(".webvtt"===a||"webvtt"===a)b=this.exportToWEBVTT();else if(".ssa"===a||"ssa"===a)b=this.exportToSSA();else if(".usf"!==
a&&"usf"!==a)if(".lrc"===a||"lrc"===a)b=this.exportToLRC();else if(".subti"===a||"subti"===a)b=this.exportToSUBTI();return b}},check:function(a){return-1!==this.subs.findIndex(function(b){return b.title===a})?(console.warn("The given title( "+a+") is already under use, please use a new one"),!1):!0},exportToSRT:function(){for(var a="",b=0;b<this.subtitles.length;b++){var c=this.subtitles[b],d=this.ranges[b],e=b+1+"\n";e+=this.convertToText(d[0],":",",")+" --\x3e "+this.convertToText(d[1],":",",")+
"\n";e+=c.join("\n");a+=e+"\n"}return a},exportToWEBVTT:function(){for(var a="WEBVTT\n",b=0;b<this.subtitles.length;b++){var c=this.subtitles[b],d=this.ranges[b],e=b+1+"\n";e+=this.convertToText(d[0])+" --\x3e "+this.convertToText(d[1])+"\n";e+=c.join("\n");a+=e+"\n"}return a},exportToSUBTI:function(){var a="";for(b in this.meta)this.meta.hasOwnProperty(b)&&(s=b+" = "+this.meta[b]+"\n",a+=s);a+="==";var b=void 0!==this.meta.names?this.meta.names:[];for(var c=0;c<this.subtitles.length;c++){var d=this.subtitles[c],
e=this.ranges[c],f=(void 0!==b[c]?b[c]:"")+"\n";f+=this.convertToText(e[0])+"=>"+this.convertToText(e[1])+"\n";f+=d.join("\n");a+=f+"\n=="}return a},exportToLRC:function(){var a="",b;for(b in this.meta)if(this.meta.hasOwnProperty(b)){var c=this.meta[b];name="artist"===b?"ar":"album"===b?"al":"title"===b?"ti":"author"===b?"au":b;a+="["+name+":"+c+"]\n"}for(b=0;b<this.subtitles.length;b++){c=this.subtitles[b][0];var d=this.convertToText(this.ranges[b][0]);a+="["+d+"]"+c+"\n"}return a},exportToSSA:function(){text=
"[Script Info]\n";for(var a in this.meta)this.meta.hasOwnProperty(a)&&(text+=a+": "+this.meta[a]+"\n");text+="\n";text+="[Events]\n";text+="Format: Start, End, Name, Text\n";a=void 0!==this.meta.names?this.meta.names:[];for(var b=0;b<this.subtitles.length;b++){var c=this.subtitles[b],d=this.convertToText(this.ranges[b][0]),e=this.convertToText(this.ranges[b][1]);text+="Dialogue: "+d+","+e+","+(void 0!==a[b]?a[b]:"Unknown")+","+c+"\n"}return text},switchToLang:function(a){void 0!==this.meta.langs&&
this.meta.langs.hasOwnProperty(a)&&(this.subtitles=this.meta.langs[a])}};return p});
