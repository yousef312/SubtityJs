var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(m){return m.raw=m};$jscomp.createTemplateTagFirstArgWithRaw=function(m,b){m.raw=b;return m};
(function(m,b){"uses strict";"function"===typeof define&&define.amd?define([],build):"object"===typeof module&&module.exports?module.exports=b():m.Subtity=b()})(this,function(){function m(){this.subs=[];this.text=this.title="";this.subtitles=[];this.ranges=[];this.current=0;this.subtitlesCounts=null;this.offset=0;this.style={family:"Arial",size:19,lineSpacing:5,color:"rgb(255,255,255)",align:"center",direction:"ltr",outlineColor:"rgb(0,0,0)",outlineSize:1,shadowColor:"rgba(0,0,0,0)",opacity:1,shadowBlur:0,
shadowX:0,shadowY:0,base:90,left:50,weight:""};this.container=this.renderer=null;this.meta={};this.video=this.mode=null;this.ctx=document.createElement("canvas").getContext("2d");this.activated=!1}m.prototype={reset:function(){this.offset=this.current=0;this.style={family:"Arial",size:19,lineSpacing:10,color:"rgb(255,255,255)",align:"center",direction:"ltr",outlineColor:"rgb(0,0,0)",outlineSize:1,shadowColor:"rgba(0,0,0,0)",shadowBlur:0,opacity:1,shadowX:0,shadowY:0,base:90,left:50,weight:""};this.subtitles=
[];this.ranges=[];this.activated=!1;this.subtitlesCounts=0;this.meta={};this.title=""},use:function(b){var a=this,c=this.subs.findIndex(function(f){return f.title===b});if(-1!==c){if(""!==this.title){var e=this.subs.findIndex(function(f){return f.title===a.title});this.subs[e].used=!1}this.current=0;this.reset();this.subs[c].used=!0;this.title=this.subs[c].title;this.ranges=this.subs[c].ranges;this.subtitles=this.subs[c].subtitles;this.text=this.subs[c].text;this.subtitlesCounts=this.subs[c].count;
this.activated=!0;this.meta=this.subs[c].meta;this.calcFontHeight()}},parseSRT:function(b,a,c){var e=b.split("\n");b={movie:c,title:a,ranges:[],meta:{},subtitles:[],text:b,count:0};a=!1;c=[];for(var f=0;f<e.length;f++){var d=e[f];1==d.length&&(a=!1,b.subtitles.push(c),c=[]);-1!==d.indexOf("--\x3e")?(b.ranges.push(this.getSeconds(d)),a=!0):!0===a&&1!==d.length&&c.push(d)}b.count=b.subtitles.length;this.subs.push(b)},parseWEBVTT:function(b,a,c){b=b.split("\n");var e=!1;a={movie:c,title:a,meta:{},ranges:[],
subtitles:[]};c=[];for(var f=0;f<b.length;f++){var d=b[f];-1===d.indexOf("NOTE ")&&-1===d[0].indexOf("NOTE\n")&&(e&&1!==d.length&&c.push(d),-1!==d.indexOf("--\x3e")?(e=this.getSeconds(d),a.ranges.push(e),e=!0):1===d.length&&!0===e&&(e=!1,a.subtitles.push(c),c=[]))}a.count=a.subtitles.length;this.subs.push(a)},parseSBV:function(b,a,c){b=b.split("\n");var e=!1,f=!1,d=-1;a={movie:c,title:a,meta:{},ranges:[],subtitles:[]};1===b[0].length&&(e=!0);for(c=0;c<b.length;c++){var g=b[c];!0===f&&1!==g.length&&
a.subtitles[d].push(g);!0===e&&(a.ranges.push(this.getSeconds(g)),e=!1,f=!0,d++,a.subtitles[d]=[]);1===g.length&&(e=!0,f=!1)}a.count=a.subtitles.length;this.subs.push(a)},parseSSA:function(b,a,c){b=b.split("\n");var e=null,f=null;a={movie:c,title:a,meta:{},ranges:[],subtitles:[],count:null};for(c=0;c<b.length;c++){var d=b[c];if("["===d[0])f=d.substr(1,d.indexOf("]")-1).toLowerCase();else if("events"===f){d=d.split(":");if(2<d.length){for(var g=2;g<d.length;g++)d[1]+=":"+d[g];d.splice(2,d.length)}g=
d[0].toLowerCase();d=d[1];"format"===g?e=d.toLowerCase().split(","):"dialogue"===g&&(d=d.split(","),k=e.findIndex(function(h){return"text"===h.trim()}),g=d[k],i0=e.findIndex(function(h){return"start"===h.toLowerCase().trim()}),i1=e.findIndex(function(h){return"end"===h.toLowerCase().trim()}),t1=this.convertToTime(d[i0]),t2=this.convertToTime(d[i1]),a.ranges.push([t1,t2]),a.subtitles.push([g]))}else"script info"===f&&";"!==d[0]&&(d=d.split(":"),g=spaceoff(d[0]),a.meta[g]=d[1])}a.count=a.subtitles.length;
this.subs.push(a)},parseITT:function(b,a,c){b=b.split("<body>")[1].split("</body>")[0].split("<p ");a={movie:c,title:a,meta:{},ranges:[],subtitles:[],count:null};for(c=0;c<b.length;c++)if("b"===b[c][0]){var e=b[c].split(">");var f=e[0].split('"');f=[this.convertToTime(f[1]),this.convertToTime(f[3])];f[1]+=f[0];e.shift();for(var d="",g=0;g<e.length;g++){var h=e[g].replace("<br","\n");for(var l=0;l<h.length&&"<span"!==h[l]+h[l+1]+h[l+2]+h[l+3]+h[l+4]&&"</"!==h[l]+h[l+1];l++)d+=h[l]}d=d.split("\n");
a.ranges.push(f);a.subtitles.push(d)}a.count=a.subtitles.length;this.subs.push(a)},parseUSF:function(b,a,c){var e=b.split("<metadata>")[1].split("</metadata>")[0];b=b.split("<subtitles>")[1].split("</subtitles>")[0].split("<subtitle ");a={movie:c,title:a,ranges:[],meta:{},subtitles:[],count:null};var f="",d="",g=!1;c=[null,null];-1!==e.indexOf("<title>")&&(a.meta.title=e.split("<title>")[1].split("</title>")[0]);-1!==e.indexOf("<date>")&&(a.meta.date=e.split("<date>")[1].split("</date>")[0]);-1!==
e.indexOf("<author>")&&(f=e.split("<author>")[1].split("</author>")[0],-1!==f.indexOf("<name>")&&(a.meta.authorName=f.split("<name>")[1].split("</name>")[0]),-1!==f.indexOf("<url>")&&(a.meta.authorUrl=f.split("<url>")[1].split("</url>")[0]),-1!==f.indexOf("<email>")&&(a.meta.authorEmail=f.split("<email>")[1].split("</email>")[0]));-1!==e.indexOf("<language")&&(a.meta.language="",t=e.split("<language ")[1].split("</language>")[0],a.meta.language=t.substr(t.indexOf(">")+1,t.length));for(e=0;e<b.length;e++)if("s"===
b[e][0]){f=b[e];var h=b[e].split(">")[0].split('"'),l=this.convertToTime(h[1]);h=this.convertToTime(h[3]);-1!==f.indexOf("<text ")?(c[0]="<text ",c[1]="</text>"):-1!==f.indexOf("<karaoke ")&&(c[0]="<karaoke ",c[1]="</karaoke>");d=f.split(c[0])[1].split(c[1])[0];f="";g=!1;for(var n=d.indexOf(">");n<d.length;n++){var p=d[n];"<"===d[n]&&" "!==d[n+1]&&(g=!1);g&&(f+=p);">"===p&&(g=!0)}d=a.ranges.findIndex(function(q){return l>=q[0]&&l<=q[1]});-1!==d?a.subtitles[d]=a.subtitles[d].concat(f.split("\n")):
(a.subtitles.push(f.split("\n")),a.ranges.push([l,h]))}a.count=a.subtitles.length;this.subs.push(a)},convertToText:function(b,a){a=void 0===a?":":a;var c=b/3600;b-=3600*c;var e=b/60;return c+a+e+a+(b-60*e)},convertToTime:function(b){var a=b.split(":");a[2]=a[2].replace(",",".");if(3===a.length){b=parseFloat(a[0]);var c=parseFloat(a[1]);a=parseFloat(a[2])}else b=0,c=parseFloat(a[0]),a=parseFloat(a[1]);return 0+(3600*b+60*c+a)},getSeconds:function(b){var a=[0,0];b=-1===b.indexOf("--\x3e")?b.split(","):
b.split("--\x3e");a[0]=this.convertToTime(b[0]);a[1]=this.convertToTime(b[1]);return a},update:function(){if(null===this.mode)console.warn("Must set up the parser rendering mode first!`Subtity.setUp2D or Subtity.setUpContainer`");else if(0!==this.ranges.length&&0!==this.subtitles.length&&!1!==this.activated){current=this.video.currentTime;mov=this.video.src;for(var b=0;b<this.ranges.length;b++){var a=this.ranges[b],c=this.subtitles[b];current-=this.offset;if(current>=a[0]&&current<=a[1])if(this.current=
b,1===this.mode)this.container.innerText=this.subtitles[this.current];else{family=this.style.family||"Arial";base=this.style.base||90;left=this.style.left||50;size=this.style.size||25;align=this.style.align||"center";color=this.style.color||"white";bg=this.style.bg||"rgba(0,0,0,0)";direction=this.style.direction||"ltr";opacity=this.style.opacity||1;weight=this.style.weight||"bold";marginL=this.style.marginLeft;marginT=this.style.marginTop;outlineColor=this.style.outlineColor||"black";outlineSize=
this.style.outlineSize||1;shadowColor=this.style.shadowColor||"rgba(0,0,0,0)";shadowX=this.style.shadowX||0;shadowY=this.style.shadowY||0;shadowBlur=this.style.shadowBlur||0;lineSpacing=this.style.lineSpacing||0;lineHeight=this.style.lineHeight;this.renderer.beginPath();x=this.renderer.canvas.width/100*left;y=this.renderer.canvas.height/100*base;this.renderer.fillStyle=color;this.renderer.textAlign=align;this.renderer.direction=direction;this.renderer.font=weight+" "+size+"px "+family;this.renderer.shadowColor=
shadowColor;this.renderer.shadowBlur=shadowBlur;this.renderer.shadowOffsetX=shadowX;this.renderer.shadowOffsetY=shadowY;this.renderer.globalAlpha=opacity;for(a=c.length-1;-1<a;a--){var e=c[a];this.renderer.strokeStyle=outlineColor;this.renderer.lineWidth=2*outlineSize;this.renderer.strokeText(e,x,y);this.renderer.lineWidth=1;this.renderer.fillText(e,x,y);y-=lineHeight+lineSpacing}this.renderer.closePath()}}}},setUp2D:function(b,a){this.renderer=b instanceof CanvasRenderingContext2D?b:b.getContext("2d");
this.mode=2;this.video=a},setUpContainer:function(b,a){this.container=b;this.mode=1;this.video=a},setOffset:function(b){this.offset="number"!==typeof b||isNaN(b)?this.offset:b},set:function(b,a){switch(b){case "family":this.style.family=a;this.calcFontHeight();break;case "color":this.style.color=a;break;case "weight":this.style.weight=a;break;case "size":this.style.size=parseFloat(a);this.calcFontHeight();break;case "align":this.style.align=a;break;case "direction":this.style.direction=a;break;case "shawX":this.style.shadowX=
parseFloat(a);break;case "shawY":this.style.shadowY=parseFloat(a);break;case "shawBlur":this.style.shadowBlur=a;break;case "shawColor":this.style.shadowColor=a;break;case "bg":this.style.bg=a;break;case "outlineColor":this.style.outlineColor=a;break;case "outlineSize":this.style.outlineSize=parseFloat(a);break;case "lineSpacing":this.style.lineSpacing=parseFloat(a);break;case "base":this.style.base=parseFloat(a);break;case "left":this.style.left=parseFloat(a);break;case "opacity":this.style.opacity=
isNaN(parseFloat(a))?1:parseFloat(a)}},calcFontHeight:function(){fontSize=parseFloat(this.style.size);fontFamily=this.style.family;var b=this.ctx;b.canvas.width=b.canvas.width;b.fillRect(0,0,b.canvas.width,b.canvas.height);b.textBaseline="top";b.font=fontSize+"px "+fontFamily;b.fillStyle="white";b.fillText("gM",0,0);for(var a=b.getImageData(0,0,b.canvas.width,b.canvas.height).data,c=-1,e=-1,f=0;f<b.canvas.height;f++)for(var d=0;d<b.canvas.width;d++)if(0===a[4*(f*b.canvas.width+d)]){if(d===b.canvas.width-
1&&-1!==c){e=f;f=b.canvas.height;break}}else{-1===c&&(c=f);break}this.style.lineHeight=e-c},loadDefaultStyle:function(){this.style={family:"Arial",size:19,lineSpacing:10,color:"rgb(255,255,255)",align:"center",direction:"ltr",outlineColor:"rgb(0,0,0)",outlineSize:1,shadowColor:"rgba(0,0,0,0)",opacity:1,shadowBlur:0,shadowX:0,shadowY:0,base:90,left:50,weight:""};this.offset=0},toggleActivation:function(b){return this.activated="boolean"===typeof b?b:!this.activated},remove:function(b){var a=this.subs.findIndex(function(c){return c.title===
b});return-1!==a?(!0===this.subs[a].used&&this.reset(),this.subs.splice(a,1)):!1},add:function(b,a,c,e){"string"===typeof c&&"string"===typeof a&&""!==b&&!1!==this.check(b)&&(c=c.toLowerCase(),".srt"===c||"srt"===c?this.parseSRT(a,b,e):".sbv"===c||"sbv"===c?this.parseSBV(a,b,e):".itt"===c||"itt"===c?this.parseITT(a,b,e):".webvtt"===c||"webvtt"===c?this.parseWEBVTT(a,b,e):".ssa"===c||"ssa"===c?this.parseSSA(a,b,e):(".usf"===c||"usf"===c)&&this.parseUSF(a,b,e))},check:function(b){return-1!==this.subs.findIndex(function(a){return a.title===
b})?(console.warn("The given title( "+b+") is already under use, please use a new one"),!1):!0},exportToSRT:function(){for(var b="",a=0;a<this.subtitle.length;a++){var c=this.subtitle[a],e=this.ranges[a],f=a+"\n";f+=this.convertToText(e[0])+" --\x3e "+this.convertToText(e[1])+"\n";for(e=0;e<c.length;e++)f+=c+"\n";b+=f+"\n"}return b}};return m});
